{% extends "membership/base.html" %}
{% load staticfiles %}
{% load bootstrap4 %}
{% load util_tags %}


{% block extra_css %}
  <link href="{% static 'dj/css/datatables.min.css' %}" rel="stylesheet">
  <style>
    .dataTables_wrapper table thead {
      display: none;
    }

    .table td{
      border-top: 0px !important;
    }

    tr:not(:last-child) > td > div {
      padding-bottom: 19px;
      border-bottom: 1px solid #979797;
    }

    .event-listing:hover {
      color: #D60B30
    }

    .event-listing:hover span {
      color: #D60B30;
      transition-duration: .2s;
      transition-timing-function: ease-in
    }

    .event-listing span {
      display: block;
    }

    .event-listing .event-heading {
      font-size: 18px;
      font-weight: 700;
      color: #031E41
    }

    .event-listing .event-date,
    .event-listing .event-info,
    .event-listing .event-location {
      font-size: 14px;
      color: #979797
    }

  .bottomBordered{
      border-bottom: 1px solid black;
  }

  .bottomBordered:last-child{
      border-bottom:none;
  }

  .eventTitle{
      font-size: large;
      font-weight: bold;
  }

  .eventDate{
      font-size: medium;
      padding-top:0.5rem !important;
      padding-bottom: 0.5rem !important;
  }


  </style>

{% endblock %}

{% block breadcrumb_items %}
  <li class="breadcrumb-item active" aria-current="page">Events</li>
{% endblock %}

{% block content %}
  <div class="card">
    <div class="card-header">
      <h4 class="mb-0">Event List</h4>
        <div style="float: right">
            <input type="text" class="form-control" id="search" placeholder="Search...">
        </div>
    </div>
    <div class="card-body p-0">
      <div class="table-responsive">
        <table id="event_table" class="table">
          <tbody>
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock content %}
{% block extra_js %}
  <script src="{% static 'dj/js/datatables.js' %}"></script>
  <script src="{% static 'dj/js/moment.js' %}"></script>

  <script type="text/javascript">
    $(document).ready(function () {
      let eventUrl = "{% url 'membership_rest_api:event-list' 'v1' %}";
      $.get( eventUrl, { 'page_size':'0'} )
          .done(function( data ) {
              $.each(data.results,function(){
                  $('#event_table').append("<tr class='eventRow bottomBordered'></tr>");
                  $('.eventRow:last').append("<td class='eventCell'>");
                  $('.eventCell:last').append("<tr><td class='eventTitle'>"+this["name"]+"</td></tr>");
                  $('.eventCell:last').append("<tr><td class='eventDate'>"+this["start_date"]+'-'+this["end_date"]+"</td></tr>");
                  $('.eventCell:last').append("<tr><td class='eventLocation'>"+this["location"]+"</td></tr>");
              })
          });
      $("#search").on("keyup paste", function() {
        var value = $(this).val().toUpperCase();
            var $rows = $(".eventRow");

        if(value === ''){
            $rows.show();
            return false;
        }
console.log($rows)
        $rows.each(function(index) {
                $row = $(this);

                var column1 = $row.find(".eventTitle").html().toUpperCase();
                var column2 = $row.find(".eventDate").html().toUpperCase();
                var column3 = $row.find(".eventLocation").html().toUpperCase();

                if ((column1.indexOf(value) > -1) || (column2.indexOf(value) > -1) || (column3.indexOf(value) > -1)) {
                    $row.show();
                }
                else {
                    $row.hide();
                }
        });
    })
      /*
      $('#event_table').DataTable({
        ajax: {
          url: eventUrl,
          dataSrc: "results"
        },
        columnDefs: [{
          targets: 0,
          data: null, // Use the full data source object for the renderer's source
          render: function (data, type, row, meta) {
            return `<div class="event-listing">
                        <span class="event-heading">${data.name}</span>
                        <span class="event-date">
                            ${moment(data.start_date).format("dddd, MMMM Do YYYY")} -
                            ${moment(data.end_date).format("dddd, MMMM Do YYYY")}
                        </span>
                    </div>`

          }
        }]
      });
      */
      /*
      $.get(eventUrl, function (data, status) {
          console.log(data);
          $.fn.dataTable.ext.errMode = 'none';
          $('#event_table').DataTable({
              data: data.results,
              createdRow: function (row, data, dataIndex) {
                  $(row).html(`
                      <div class="event-listing">
                          <span class="event-heading">${data.name}</span>
                          <span class="event-date">
                              ${moment(data.start_date).format("dddd, MMMM Do YYYY")} -
                              ${moment(data.end_date).format("dddd, MMMM Do YYYY")}
                          </span>
                      </div>`)
              }
          });
      })
      */
    });
  </script>
{% endblock extra_js %}